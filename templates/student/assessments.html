{% extends "base.html" %}

{% block title %}Available Exams - Student{% endblock %}

{% block content %}
<div class="mb-8">
    <h1 class="text-3xl font-bold text-gray-800">Available Exams</h1>
    <p class="text-gray-600 mt-2">View and attempt exams for your class</p>
</div>

<div class="grid grid-cols-1 gap-6">
    {% if exams %}
        {% for item in exams %}
        {% set start_nigeria = item.assessment.scheduled_start.replace(tzinfo=utc).astimezone(ZoneInfo('Africa/Lagos')) if item.assessment.scheduled_start else None %}
        {% set end_nigeria = item.assessment.scheduled_end.replace(tzinfo=utc).astimezone(ZoneInfo('Africa/Lagos')) if item.assessment.scheduled_end else None %}
        {% set is_active = start_nigeria and end_nigeria and start_nigeria <= now <= end_nigeria %}
        <div class="bg-white rounded-lg shadow-md p-6 border-l-4 {% if is_active %} border-green-500 {% else %} border-blue-500 {% endif %}">
            <div class="flex items-start justify-between">
                <div class="flex-1">
                    <h3 class="text-xl font-bold text-gray-800 mb-2">{{ item.assessment.title }}</h3>
                    <p class="text-gray-600 mb-4">{{ item.assessment.description }}</p>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-sm mb-4">
                        <div class="flex items-center">
                            <i class="fas fa-book text-blue-500 mr-2"></i>
                            <span>{{ item.assessment.subject.name }}</span>
                        </div>
                        <div class="flex items-center">
                            <i class="fas fa-question-circle text-green-500 mr-2"></i>
                            <span>{{ item.assessment.questions|length }} questions</span>
                        </div>
                        <div class="flex items-center">
                            <i class="fas fa-clock text-yellow-500 mr-2"></i>
                            <span>{{ item.assessment.duration_minutes }} minutes</span>
                        </div>
                        <div class="flex items-center">
                            <i class="fas fa-award text-purple-500 mr-2"></i>
                            <span>{{ item.assessment.total_marks }} marks</span>
                        </div>
                    </div>
                    {% if start_nigeria and end_nigeria %}
                    <div class="flex items-center gap-2 text-sm mb-2">
                        <i class="fas fa-calendar-alt text-gray-500"></i>
                        <span>{{ start_nigeria.strftime('%b %d, %Y %I:%M %p') }} - {{ end_nigeria.strftime('%b %d, %Y %I:%M %p') }}</span>
                    </div>
                    {% endif %}
                    <div class="flex items-center gap-4 text-sm">
                        <span class="text-gray-600">
                            <i class="fas fa-redo mr-1"></i>
                            Attempts: {{ item.attempt_count }}/{{ item.assessment.max_attempts if item.assessment.allow_multiple_attempts else 1 }}
                        </span>
                        {% if not item.can_attempt %}
                        <span class="text-red-600 font-semibold">
                            <i class="fas fa-ban mr-1"></i>No more attempts allowed
                        </span>
                        {% endif %}
                        {% if is_active %}
                        <span class="text-green-600 font-semibold">
                            <i class="fas fa-play-circle mr-1"></i>Active Now
                        </span>
                        {% endif %}
                    </div>
                </div>
                <a href="{{ url_for('student.assessment_info', exam_id=item.assessment.id) }}" 
                   class="ml-4 px-6 py-3 rounded-lg font-medium transition
                   {% if not item.can_attempt %} bg-gray-400 cursor-not-allowed {% else %} bg-blue-600 hover:bg-blue-700 text-white {% endif %}">
                    <i class="fas fa-arrow-right mr-2"></i>View Assessment
                </a>
            </div>
        </div>
        {% endfor %}
    {% else %}
    <div class="bg-white rounded-lg shadow-md p-12 text-center">
        <i class="fas fa-inbox text-gray-300 text-6xl mb-4"></i>
        <p class="text-gray-500 text-lg">No exams available at the moment</p>
        <p class="text-gray-400 text-sm mt-2">Check back later for new exams</p>
    </div>
    {% endif %}
</div>
{% endblock %}
