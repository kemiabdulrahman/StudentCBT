{% extends "base.html" %}

{% block title %}Result Details - CBT System{% endblock %}

{% block content %}
<div class="max-w-5xl mx-auto">
    <!-- Header -->
    <div class="mb-6">
        <h1 class="text-3xl font-bold text-gray-800">Result Details</h1>
        <p class="text-gray-600 mt-2">View detailed performance for a studentâ€™s exam</p>
    </div>

    <!-- Student and Exam Info -->
    <div class="bg-white rounded-lg shadow p-6 mb-6">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
                <h2 class="text-lg font-semibold text-gray-800 mb-2">Student Information</h2>
                <p class="text-gray-700 font-medium">{{ result.attempt.student.full_name }}</p>
                <p class="text-gray-500">Student ID: {{ result.attempt.student.student_id }}</p>
                <p class="text-gray-500">Class: {{ result.attempt.exam.school_class.name }}</p>
            </div>
            <div>
                <h2 class="text-lg font-semibold text-gray-800 mb-2">Exam Information</h2>
                <p class="text-gray-700 font-medium">{{ result.attempt.exam.title }}</p>
                <p class="text-gray-500">Subject: {{ result.attempt.exam.subject.name }}</p>
                <p class="text-gray-500">Term: {{ result.attempt.exam.term.name }}</p>
                <p class="text-gray-500">Date Taken: {{ result.attempt.submitted_at.strftime('%b %d, %Y %I:%M %p') if result.attempt.submitted_at else 'N/A' }}</p>
            </div>
        </div>
    </div>

    <!-- Score Summary -->
    <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
        <div class="bg-white rounded-lg shadow p-6 text-center">
            <p class="text-sm text-gray-500">Total Marks</p>
            <p class="text-3xl font-bold text-gray-800">{{ result.total_marks }}</p>
        </div>
        <div class="bg-white rounded-lg shadow p-6 text-center">
            <p class="text-sm text-gray-500">Marks Obtained</p>
            <p class="text-3xl font-bold text-gray-800">{{ result.marks_obtained }}</p>
        </div>
        <div class="bg-white rounded-lg shadow p-6 text-center">
            <p class="text-sm text-gray-500">Percentage</p>
            <p class="text-3xl font-bold text-gray-800">{{ "%.1f"|format(result.percentage) }}%</p>
        </div>
        <div class="bg-white rounded-lg shadow p-6 text-center">
            <p class="text-sm text-gray-500">Grade</p>
            <span class="px-4 py-2 text-lg font-semibold rounded-full 
                {% if result.grade == 'A' %}bg-green-100 text-green-800
                {% elif result.grade == 'B' %}bg-blue-100 text-blue-800
                {% elif result.grade == 'C' %}bg-yellow-100 text-yellow-800
                {% elif result.grade == 'D' %}bg-orange-100 text-orange-800
                {% else %}bg-red-100 text-red-800{% endif %}">
                {{ result.grade }}
            </span>
        </div>
    </div>

    <!-- Answers Section -->
    <div class="bg-white rounded-lg shadow overflow-hidden mb-6">
        <div class="px-6 py-4 bg-gray-50 border-b border-gray-200 flex justify-between items-center">
            <h2 class="text-lg font-semibold text-gray-800">Answers Overview</h2>
            <span class="text-sm text-gray-500">Total Questions: {{ answers|length }}</span>
        </div>

        <div class="divide-y divide-gray-200">
            {% for answer in answers %}
            <div class="p-6 hover:bg-gray-50">
                <div class="flex justify-between items-start mb-2">
                    <p class="text-gray-800 font-medium">Q{{ loop.index }}. {{ answer.question.question_text }}</p>
                    <span class="text-sm font-semibold {% if answer.is_correct %}text-green-600{% else %}text-red-600{% endif %}">
                        {% if answer.is_correct %}<i class="fas fa-check-circle"></i> Correct{% else %}<i class="fas fa-times-circle"></i> Incorrect{% endif %}
                    </span>
                </div>

                {% if answer.question.question_type == 'mcq' %}
                <div class="mt-2">
                    <p class="text-gray-700"><strong>Your Answer:</strong> {{ answer.answer_text or 'Not answered' }}</p>
                    <p class="text-gray-700"><strong>Correct Answer:</strong> {{ answer.question.correct_answer }}</p>
                </div>
                {% elif answer.question.question_type in ['short_answer', 'essay'] %}
                <div class="mt-2">
                    <p class="text-gray-700"><strong>Your Answer:</strong></p>
                    <p class="text-gray-600 bg-gray-50 p-2 rounded">{{ answer.answer_text or 'Not answered' }}</p>
                    {% if answer.teacher_feedback %}
                    <p class="text-gray-700 mt-1"><strong>Feedback:</strong> {{ answer.teacher_feedback }}</p>
                    {% endif %}
                </div>
                {% endif %}

                <div class="mt-3 text-sm text-gray-500">
                    Marks: {{ answer.marks_obtained }}/{{ answer.question.marks }}
                </div>
            </div>
            {% else %}
            <div class="p-12 text-center">
                <i class="fas fa-clipboard-list text-5xl text-gray-300 mb-3"></i>
                <p class="text-gray-600">No answers available for this attempt.</p>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- Status Section -->
    <div class="bg-white rounded-lg shadow p-6">
        <h2 class="text-lg font-semibold text-gray-800 mb-3">Result Status</h2>
        {% if result.published %}
        <p class="text-green-600 font-medium"><i class="fas fa-check-circle mr-2"></i>Published on {{ result.published_at.strftime('%b %d, %Y %I:%M %p') if result.published_at else 'N/A' }}</p>
        {% else %}
        <p class="text-yellow-600 font-medium"><i class="fas fa-clock mr-2"></i>Pending Publication</p>
        {% endif %}
    </div>

    <!-- Back Button -->
    <div class="mt-6 text-center">
        <a href="{{ url_for('teacher.results') }}" class="inline-flex items-center px-6 py-2 bg-blue-600 text-white font-semibold rounded hover:bg-blue-700">
            <i class="fas fa-arrow-left mr-2"></i> Back to Results
        </a>
    </div>
</div>
{% endblock %}
