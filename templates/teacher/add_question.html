{% extends "base.html" %}

{% block title %}Add Question - {{ exam.title }}{% endblock %}

{% block content %}
<div class="mb-8">
    <a href="{{ url_for('teacher.exam_details', exam_id=exam.id) }}" class="text-blue-600 hover:text-blue-800 mb-4 inline-block">
        <i class="fas fa-arrow-left mr-2"></i>Back to Exam
    </a>
    <h1 class="text-3xl font-bold text-gray-800">Add Question</h1>
    <p class="text-gray-600 mt-2">{{ exam.title }}</p>
</div>

<div class="bg-white rounded-lg shadow-md p-8 max-w-3xl">
    <form method="POST" action="{{ url_for('teacher.add_question', exam_id=exam.id) }}">
        {{ form.hidden_tag() }}
        
        <div class="mb-6">
            <label class="block text-sm font-medium text-gray-700 mb-2">Question Text *</label>
            {{ form.question_text(class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent", rows="4", placeholder="Enter your question here") }}
            {% if form.question_text.errors %}
                <p class="text-red-500 text-sm mt-1">{{ form.question_text.errors[0] }}</p>
            {% endif %}
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Question Type *</label>
                {{ form.question_type(class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent", id="questionType") }}
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Marks *</label>
                {{ form.marks(class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent", placeholder="1") }}
            </div>
        </div>

        <!-- MCQ Options -->
        <div id="mcqOptions" style="display:none;">
            <div class="bg-blue-50 rounded-lg p-6 mb-6">
                <h3 class="font-bold text-gray-800 mb-4">Multiple Choice Options</h3>
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Option A</label>
                        {{ form.option_a(class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent") }}
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Option B</label>
                        {{ form.option_b(class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent") }}
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Option C</label>
                        {{ form.option_c(class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent") }}
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Option D</label>
                        {{ form.option_d(class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent") }}
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Correct Answer (A/B/C/D)</label>
                        {{ form.correct_answer(class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent", placeholder="A") }}
                    </div>
                </div>
            </div>
        </div>

        <!-- True/False Answer -->
        <div id="trueFalseAnswer" style="display:none;">
            <div class="bg-green-50 rounded-lg p-6 mb-6">
                <label class="block text-sm font-medium text-gray-700 mb-2">Correct Answer</label>
                {{ form.correct_answer(class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent", placeholder="True or False") }}
            </div>
        </div>

        <!-- Keywords for Auto-grading -->
        <div id="keywordsField" style="display:none;">
            <div class="bg-yellow-50 rounded-lg p-6 mb-6">
                <label class="block text-sm font-medium text-gray-700 mb-2">Keywords for Auto-Grading (Optional)</label>
                {{ form.keywords(class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent", placeholder="keyword1, keyword2, keyword3") }}
                <p class="text-xs text-gray-500 mt-2">Comma-separated keywords for partial auto-grading</p>
            </div>
        </div>

        <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg transition">
            <i class="fas fa-save mr-2"></i>Add Question
        </button>
    </form>
</div>
{% endblock %}

{% block scripts %}
<script>
const questionType = document.getElementById('questionType');
const mcqOptions = document.getElementById('mcqOptions');
const trueFalseAnswer = document.getElementById('trueFalseAnswer');
const keywordsField = document.getElementById('keywordsField');

function updateFields() {
    const type = questionType.value;
    mcqOptions.style.display = type === 'mcq' ? 'block' : 'none';
    trueFalseAnswer.style.display = type === 'true_false' ? 'block' : 'none';
    keywordsField.style.display = (type === 'short_answer' || type === 'essay') ? 'block' : 'none';
}

questionType.addEventListener('change', updateFields);
updateFields();
</script>
{% endblock %}